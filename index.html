<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Magical Forest</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-event-set-component/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

    <script>
      AFRAME.registerComponent("click-handler", {
        init: function () {
          // สร้างพื้นหลังสีขาว
          this.background = document.createElement("a-plane");
          this.background.setAttribute("width", "3");
          this.background.setAttribute("height", "4");
          this.background.setAttribute("color", "white");
          this.background.setAttribute("position", "0 3.4 15.5");
          this.background.setAttribute("visible", false);

          // สร้าง text entity
          // สร้าง text entity
          this.textEntity = document.createElement("a-text");
          this.textEntity.setAttribute(
            "value",
            "Welcome, adventurer, \nto the Magical Forest of Knowledge! \nStep into a world where \nmysteries unfold"
          );
          this.textEntity.setAttribute("line-height", "250"); // ค่าเป็นเปอร์เซ็นต์ของขนาดตัวอักษร
          this.textEntity.setAttribute("color", "black"); // เปลี่ยนเป็นสีดำเพื่อให้เห็นข้อความได้ชัดเจน
          this.textEntity.setAttribute("align", "center");
          this.textEntity.setAttribute("width", "3");
          this.textEntity.setAttribute("position", "0 3.4 15.9");
          this.textEntity.setAttribute("visible", false);
          this.textEntity.setAttribute("font", "mozillavr");
          // this.textEntity.setAttribute('font-size', '20');

          // เพิ่มพื้นหลังและข้อความในฉาก
          this.el.sceneEl.appendChild(this.background);
          this.el.sceneEl.appendChild(this.textEntity);

          // สร้าง timer variable
          this.messageTimer = null;

          // ใช้ click event เพียงอย่างเดียว
          this.el.addEventListener("click", (evt) => {
            this.showMessage();
          });
        },

        showMessage: function () {
          // ยกเลิก timer เก่า (ถ้ามี)
          if (this.messageTimer) {
            clearTimeout(this.messageTimer);
          }

          // แสดงข้อความและพื้นหลัง
          this.background.setAttribute("visible", true);
          this.textEntity.setAttribute("visible", true);

          // ตั้ง timer ใหม่
          this.messageTimer = setTimeout(() => {
            this.textEntity.setAttribute("visible", false);
            this.background.setAttribute("visible", false); // ซ่อนพื้นหลังเมื่อข้อความหายไป
          }, 3000);
        },

        remove: function () {
          // ทำความสะอาดเมื่อ component ถูกลบ
          if (this.messageTimer) {
            clearTimeout(this.messageTimer);
          }
          if (this.textEntity && this.textEntity.parentNode) {
            this.textEntity.parentNode.removeChild(this.textEntity);
          }
          if (this.background && this.background.parentNode) {
            this.background.parentNode.removeChild(this.background);
          }
        },
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="sky" src="image/M4.jpg" />
        <a-asset-item id="tree" src="image/Tree.glb"></a-asset-item>
        <a-asset-item id="woodenign" src="image/WoodenSign.glb"></a-asset-item>
        <a-asset-item
          id="sakura-bonsai"
          src="image/Parchament Open.glb"
        ></a-asset-item>
        <a-asset-item id="EvilBook" src="image/EvilBook.glb"></a-asset-item>
        <a-asset-item id="BookOpen" src="image/BookOpen.glb"></a-asset-item>
        <a-asset-item id="Book" src="image/Book.glb"></a-asset-item>
        <a-asset-item id="Bat" src="image/Bat.glb"></a-asset-item>
        <a-asset-item id="Scroll" src="image/Scroll.glb"></a-asset-item>
        <a-asset-item id="paper1" src="image/02_paper.glb"></a-asset-item>
        <a-asset-item id="EvilWizard" src="image/EvilWizard.glb"></a-asset-item>
        <a-asset-item id="Skeleton" src="image/SkeletonMage.glb"></a-asset-item>
        <a-asset-item id="ChibiWitch" src="image/ChibiWitch.glb"></a-asset-item>
        <a-asset-item id="Bird2" src="image/Bird (1).glb"></a-asset-item>
        <a-asset-item id="Broom" src="image/Broom Set.glb"></a-asset-item>
        <a-asset-item id="Wizard" src="image/Wizard hat.glb"></a-asset-item>
        <a-asset-item id="Staff" src="image/Staff.glb"></a-asset-item>
        <a-asset-item id="Witch" src="image/Witch.glb"></a-asset-item>
        <a-asset-item id="Cat" src="image/Cat (1).glb"></a-asset-item>
        <a-asset-item id="Dingus" src="image/Dingus the cat.glb"></a-asset-item>
        <a-asset-item
          id="Hummingbird"
          src="image/Hummingbird.glb"
        ></a-asset-item>

        <a-asset-item id="Magic" src="image/Magic cauldron.glb"></a-asset-item>
      </a-assets>

      <a-sky src="#sky"></a-sky>

      <a-entity
        gltf-model="#woodenign"
        position="-8 1 10"
        rotation="0 30 0"
        scale="2 2 2 "
      >
      </a-entity>

      <!-- พื้นหลัง -->
      <a-plane
            rotation="0 29 0" 
            position="-7.9 4.55 10.05" 
            width="2"
            height="1"
            color="#ffffff">
        </a-plane>

      <a-entity environment="preset: poison"></a-entity>

      <!-- ข้อความ -->
      <a-text
        value="Experiment with ingredients and create potions that can heal, enhance, or transform."
        position="-7.9 4.55 10.1"
        rotation="0 29 0"
        color="#000000"
        width="2"
        align="center"
      >
      </a-text>

      <a-entity
        gltf-model="#EvilBook"
        position="350 -10 -80"
        scale="30 30 30"
        animation="property: rotation; to: 0 360 0; dur: 5000; loop: true"
      >
      </a-entity>

      <a-entity
        gltf-model="#BookOpen"
        position="-1 2 1"
        rotation="50 0 0"
        scale="3 3 3"
      >
      </a-entity>

      <a-entity
        gltf-model="#Book"
        position="2 2 1"
        rotation="0 -80 0"
        scale="3 3 3"
      >
      </a-entity>

      <a-entity
        gltf-model="#Scroll"
        position="180 10 10"
        rotation="0 -160 0"
        scale="90 90 90"
      >
      </a-entity>

      <!-- โมเดล -->
      <a-entity
        gltf-model="#paper1"
        position="-15 5 -12"
        rotation="90 50 0"
        scale="3 3 3"
      >
      </a-entity>

      <!-- พื้นหลัง -->
      <a-plane
        rotation="0 50 0"
        position="-15 5 -11.9"
        width="4"
        height="5.4"
        color="#ffffff"
      >
      </a-plane>

      <!-- ข้อความ -->
      <a-text
        value="1. The Enchanted Library: \nDiscover magical texts and\n spellcasting secrets.\n  
        2. The Potion Workshop:\n Learn potion-making with\n hands-on experiments.\n  
        3. The Whispering Woods:\n Hear enchanted stories\n from the magical forest."
        position="-15 5 -11.7"
        rotation="0 50 0"
        color="#000000"
        width="6"
        align="center"
      >
      </a-text>

      <!-- โมเดล -->
      <a-entity
        gltf-model="#paper1"
        position="-15 5 1"
        rotation="90 50 0"
        scale="3 3 3"
      >
      </a-entity>

      <!-- พื้นหลัง -->
      <a-plane
        rotation="0 50 0"
        position="-14.4 5 1.5"
        width="4"
        height="5.4"
        color="#ffffff"
      >
      </a-plane>

      <!-- ข้อความ -->
      <a-text
        value="1. The Crystal Cavern \n
        Explore shimmering crystals \n and their magical \n properties hidden deep \n underground. \n
        2. The Mystic Observatory \n
        Gaze into the stars and learn \n about celestial magic \n and ancient constellations. \n"
        position="-14.4 5 1.5"
        rotation="0 50 0"
        color="#000000"
        width="6"
        align="center"
      >
      </a-text>

      <a-entity
        gltf-model="#EvilWizard"
        position="1 1 -15"
        rotation="0 -5 0"
        scale="2 2 2 "
      >
      </a-entity>

      <a-entity
        gltf-model="#Skeleton"
        position="-20  20 -50"
        rotation="20 20 0"
        scale="10 10 10"
      >
      </a-entity>

      <a-entity
        gltf-model="#ChibiWitch"
        position="-30  20 5"
        rotation="20 60 0"
        scale="3 3 3"
      >
      </a-entity>

      <a-entity
        gltf-model="#Bat"
        position="10 15 10"
        rotation="40 -60 0"
        scale="0.01 0.01 0.01"
        animation__rotation="property: rotation; to: 0 360 0; loop: true; dur: 10000; delay: 0"
        animation__movement="property: position; to: -400 100 -200; dir: alternate; loop: true; dur: 5000; delay: 0"
      >
      </a-entity>

      <a-entity
        gltf-model="#Bird2"
        position="150 100 -50"
        rotation="40 -60 0"
        scale="0.1 0.1 0.1"
        animation__rotation="property: rotation; to: 90 360 0; loop: true; dur: 7000; delay: 2500"
        animation__movement="property: position; to: -400 100 -200; dir: alternate; loop: true; dur: 5000; delay: 2500"
      >
      </a-entity>
      <a-entity
        gltf-model="#Hummingbird"
        position="1 10 1"
        rotation="40 -60 0"
        scale="3 3 3"
        animation__rotation="property: rotation; to: 90 360 0; loop: true; dur: 10000; delay: 3000"
        animation__movement="property: position; to: -100 100 -500; dir: alternate; loop: true; dur: 15000; delay: 3000"
      >
      </a-entity>
      <a-entity
        gltf-model="#tree"
        position="20 -1 10"
        scale="0.1 0.1 0.1"
        animation="property: rotation; to: 0 360 0; dur: 10000; loop: true"
      >
      </a-entity>

      <a-entity
        gltf-model="#Broom"
        position="15 5 -5"
        rotation="0 90 0"
        scale="5 5 5"
      >
      </a-entity>

      <a-entity
        gltf-model="#Wizard"
        position="10  80 -50"
        rotation="0 30 0"
        scale="30 30 30"
      >
      </a-entity>

      <a-entity
        gltf-model="#Staff"
        position="5 5 -8"
        rotation="0 60 0"
        scale="3 3 3"
      >
      </a-entity>

      <a-entity
        gltf-model="#Magic"
        position="-8 -1 -8"
        rotation="0 60 0"
        scale="3 3 3"
      >
      </a-entity>

      <a-entity
        gltf-model="#Cat"
        position="8 0 -5"
        rotation="-90 -40 0"
        scale="0.01 0.01 0.01"
      >
      </a-entity>

      <a-entity
        gltf-model="#Dingus"
        position="-20 -1 -8"
        rotation="0 90 0"
        scale="1 1 1"
      >
      </a-entity>

      <a-entity
        gltf-model="#Witch"
        position="30 10 -8"
        rotation="0 200 -20"
        scale="3 3 3"
      >
      </a-entity>

      <a-entity
        gltf-model="#sakura-bonsai"
        geometry="primitive: box; width: 2; height: 2; depth: 2"
        material="opacity: 0"
        position="0 3.4 15"
        scale="0.2 0.2 0.2"
        id="sakura-bonsai"
        class="clickable"
        click-handler
        animation__hover="property: scale; to: 0.3 0.3 0.3; startEvents: mouseenter; dur: 200"
        animation__leave="property: scale; to: 0.2 0.2 0.2; startEvents: mouseleave; dur: 200"
      >
      </a-entity>

      <a-sound
        src="image/Where Secrets Slumber - Orchestral⧸Fantasy Music.mp3"
        autoplay="true"
        loop="true"
        volume="1"
        position="0 2 -5"
      >
      </a-sound>

      <a-sky color="#001a33"></a-sky> <!-- ท้องฟ้ากลางคืน -->
        <a-light type="ambient" color="#888" intensity="0.5"></a-light>


      <!-- ปรับปรุง camera setup -->
      <a-entity position="0 1.6 20">
        <a-camera look-controls wasd-controls="speed:100000000">
          <a-entity
            cursor="rayOrigin: mouse"
            raycaster="objects: .clickable; far: 100"
            position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
            material="color: white; shader: flat"
            scale="0.5 0.5 0.5"
            animation__click="property: scale; from: 0.5 0.5 0.5; to: 0.1 0.1 0.1; dur: 150; startEvents: click"
            animation__clickback="property: scale; to: 0.5 0.5 0.5; dur: 150; startEvents: clickback"
          >
          </a-entity>
        </a-camera>
      </a-entity>
    </a-scene>
  </body>
</html>
